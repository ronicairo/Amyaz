{% extends 'base.html.twig' %}

{% block title %}
	Liste des utilisateurs
{% endblock %}

{% block body %}

	<div class="row">
		<div class="col-6 mx-auto">
			{% include 'include/flashes.html.twig' %}
		</div>
	</div>

	<h1 class="text-center">Liste des utilisateurs</h1>
	<p class="text-center">
		Nombre total d'inscrits :
		{{ totalUsers }}
		<br>
		({{ verifiedUsersCount }}
		vérifiés et
		{{ unverifiedUsersCount }}
		non vérifiés)
	</p>
	<div class="mt-5 container">
		<div class="row justify-content-center">
			<div class="col-12">
				<div class="table-responsive">
					<table class="table table-striped table-bordered text-center">
						<thead class="thead-dark">
							<tr>
								<th class="align-middle">Photo</th>
								<th class="align-middle">Rôle</th>
								<th class="align-middle">Nom</th>
								<th class="align-middle">Email</th>
								<th class="align-middle">Vérification</th>
								<th class="align-middle">Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for user in pagination %}
								<tr>
									<td>
										{% if user.picture %}
											<img src="{{ asset('uploads/profile/' ~ user.picture) }}" alt="user-profile-picture" width="50" height="50" class="rounded-circle">
										{% else %}
											<img src="{{ asset('uploads/profile/default_profile_picture.jpg') }}" alt="user" width="50" height="50" class="rounded-circle">
										{% endif %}
									</td>
									<td>
										<form method="post" action="{{ path('app_user_change_role', { id: user.id }) }}" style="display:inline-block;">
											<select name="role" class="form-select form-select-sm" onchange="this.form.submit()">
												<option value="ROLE_USER" {% if 'ROLE_USER' in user.roles %} selected {% endif %}>Utilisateur</option>
												<option value="ROLE_MODERATOR" {% if 'ROLE_MODERATOR' in user.roles %} selected {% endif %}>Modérateur</option>
												<option value="ROLE_ADMIN" {% if 'ROLE_ADMIN' in user.roles %} selected {% endif %}>Administrateur</option>
											</select>
											<input type="hidden" name="_token" value="{{ csrf_token('change_role' ~ user.id) }}">
										</form>
									</td>
									<td>{{ user.username }}</td>
									<td>{{ user.email }}</td>
									<td>
										{% if user.isVerified %}
											<span class="badge bg-success">Vérifié</span>
										{% else %}
											<span class="badge bg-warning">Non vérifié</span>
										{% endif %}
									</td>
									{% if is_granted('ROLE_ADMIN') %}
										<td>
											<a style="border:none;" href="{{ path('app_user_show', { id: user.id }) }}" class="btn btn-outline-dark btn-sm">
												<i class="bi bi-eye"></i>
											</a>
											<form method="post" action="{{ path('admin_user_delete', { id: user.id }) }}" style="display:inline-block;">
												<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
												<button style="border:none;" type="submit" class="btn btn-outline-danger btn-sm">
													<i class="bi bi-trash"></i>
												</button>
											</form>
										</td>
									{% endif %}
								</tr>
							{% else %}
								<tr>
									<td colspan="6">Aucun utilisateur trouvé</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
				<div id="pagination-container" class="pagination justify-content-center mt-4">
					{{ knp_pagination_render(pagination) }}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
