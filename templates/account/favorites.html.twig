{% extends 'base.html.twig' %}

{% block title %}
	{{ 'account.favorite'|trans }}
{% endblock %}

{% block body %}

	<style>
	/* ===============================
   FAVORITES PAGE – MODERN STYLE
================================ */

.favorite-page {
    min-height: 80vh;
    padding: 60px 20px;
    max-width: 1100px;
    margin: auto;
}

.favorite-title {
    text-align: center;
    font-family: 'Playfair Display', serif;
    margin-bottom: 40px;
    color: #1a284d;
}

.accordion-item {
    border: none;
    margin-bottom: 15px;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0,0,0,0.08);
}

.accordion-button {
    background: white;
    font-weight: 600;
    font-size: 1.1rem;
    color: #1a284d;
}

.accordion-button:not(.collapsed) {
    background: #1a284d;
    color: white;
}

.accordion-button:focus {
    box-shadow: none;
}

.accordion-body {
    background: #f8f9fb;
}

/* Cards */
.favorite-card {
    background: white;
    border-radius: 20px;
    padding: 25px;
    position: relative;
    box-shadow: 0 10px 30px rgba(26,40,77,0.08);
    transition: 0.3s;
}

.favorite-card:hover {
    transform: translateY(-4px);
}

.favorite-card h5 {
    color: #1a284d;
    font-weight: 600;
}

.favorite-card p {
    color: #555;
}

.remove-favorite {
    position: absolute;
    top: 15px;
    right: 15px;
    border: none;
    background: transparent;
    font-size: 22px;
    cursor: pointer;
    color: #dc3545;
}

.remove-favorite:hover {
    transform: scale(1.2);
}

/* Pagination */
.pagination {
    margin-top: 30px;
}
	</style>


    <h1 class="favorite-title">
        {{ 'account.favorite'|trans }}
    </h1>

    <div class="accordion mb-4" id="accordionTraductions">
		<div class="accordion-item">
			<h2 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
					Traductions
				</button>
			</h2>
			<div id="flush-collapseOne" class="accordion-collapse collapse">
				<div class="accordion-body">
					{% if pagination_word.items is not empty %}
						<div class="card-container">
							<div class="row">
								{% set hasTranslation = false %}
								{% for favorite in pagination_word.items %}
									{% if favorite.getTraduction() is not null %}
										{% set hasTranslation = true %}
										<div class="col-12 col-md-6 col-lg-4 mb-4">
											<div class="favorite-card">
												<!-- Ajout de position: relative -->
												<button style="color: white; position: absolute; top: 0; right: 0; margin: 0.5rem;" type="button" class="btn btn-md remove-favorite" data-type="word" data-id="{{ favorite.getTraduction().id }}">
													&times;
												</button>
												<div class="card-body">
													<h5 class="card-title">
														{% if app.request.locale == 'fr' %}
															{{ favorite.getTraduction().wordFR() }}
														{% else %}
															{{ favorite.getTraduction().wordEN() }}
														{% endif %}
													</h5>
													<p class="card-text">
														{% if favorite.getTraduction().plural() %}
															<span>{{ 'home.singular'|trans }}:
																{{ favorite.getTraduction().singular() }}</span>
															<span>{{ 'home.plural'|trans }}:
																{{ favorite.getTraduction().plural() }}</span>
															<br>
														{% else %}
															<span>{{ favorite.getTraduction().singular() }}</span>
														{% endif %}
														<br>
														{% if favorite.getTraduction().phoneticPlural() %}
															<span>{{ 'home.tifinagh_singular'|trans }}:
																{{ favorite.getTraduction().phoneticSingular() }}</span>
															<span>{{ 'home.tifinagh_plural'|trans }}:
																{{ favorite.getTraduction().phoneticPlural() }}</span>
														{% else %}
															<span>{{ favorite.getTraduction().phoneticSingular() }}</span>
														{% endif %}
													</p>
												</div>
											</div>
										</div>
									{% endif %}
								{% endfor %}
							</div>
						</div>
						{% if not hasTranslation %}
							<h6 class="text-dark text-center mt-4">{{ 'account.no_fav'|trans }}</h6>
						{% endif %}
						<div class="pagination justify-content-center mt-4">
							{{ knp_pagination_render(pagination_word) }}
						</div>
					{% else %}
						<h6 class="text-dark text-center mt-4">{{ 'account.no_fav'|trans }}</h6>
					{% endif %}
				</div>
			</div>
		</div>
	</div>

	<div class="accordion" id="accordionDocuments">
		<div class="accordion-item">
			<h2 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
					Documents
				</button>
			</h2>
			<div id="flush-collapseTwo" class="accordion-collapse collapse">
				<div class="accordion-body">
					{% if pagination_doc.items is not empty %}
						<div class="card-container">
							<div class="row">
								{% set hasDocument = false %}
								{% for favorite in pagination_doc.items %}
									{% if favorite.getDocumentation() is not null %}
										{% set hasDocument = true %}
										<div class="col-md-6 mb-4 mt-4">
											<div class="favorite-card h-100">
												<button style="color: black; right: 0; margin-right: 1rem;" type="button" class="btn btn-md position-absolute top-0 mt-2 me-2 remove-favorite" data-type="doc" data-id="{{ favorite.getDocumentation().id }}">
													&times;
												</button>
												<div class="d-flex justify-content-between align-items-center">
													<h2 class="mb-4">
														{% if app.request.locale == 'fr' %}
															{{ favorite.getDocumentation().titleFR() }}
														{% else %}
															{{ favorite.getDocumentation().titleEN() }}
														{% endif %}
													</h2>
												</div>
												<p style="color: #333;">
													{% if app.request.locale == 'fr' %}
														{{ favorite.getDocumentation().contentFR() }}
													{% else %}
														{{ favorite.getDocumentation().contentEN() }}
													{% endif %}
												</p>
												<p style="color: #333;">{{ favorite.getDocumentation().category() }}</p>
												<a style="color: #333;" href="{{ asset('uploads/' ~ favorite.getDocumentation().file) }}" download="{{ favorite.getDocumentation().file }}">{{ 'button.pdf'|trans }}</a>
											</div>
										</div>
									{% endif %}
								{% endfor %}
							</div>
						</div>
						{% if not hasDocument %}
							<h6 class="text-dark text-center mt-4">{{ 'account.no_fav'|trans }}</h6>
						{% endif %}
						<div class="pagination justify-content-center mt-4">
							{{ knp_pagination_render(pagination_doc) }}
						</div>
					{% else %}
						<h6 class="text-dark text-center mt-4">{{ 'account.no_fav'|trans }}</h6>
					{% endif %}
				</div>
			</div>
		</div>
    </div>

	</div>
<script>
document.addEventListener('DOMContentLoaded', function () {

    document.querySelectorAll('.remove-favorite').forEach(function (button) {

        button.addEventListener('click', function () {

            const id = this.getAttribute('data-id');
            const type = this.getAttribute('data-type');
            const card = this.closest('.favorite-card');
            const accordionBody = this.closest('.accordion-body');

            fetch('{{ path('fav_remove') }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRF-TOKEN': '{{ csrf_token('favorite_remove') }}'
                },
                body: JSON.stringify({ id: id, type: type })
            })
            .then(response => response.json())
            .then(data => {

                if (data.status === 'success') {

                    card.remove();

                    // Vérifie s'il reste des cards
                    if (!accordionBody.querySelector('.favorite-card')) {
                        accordionBody.innerHTML =
                            '<h6 class="text-center mt-4">{{ "account.no_fav"|trans }}</h6>';
                    }

                } else if (data.status === 'error' && data.message) {
                    alert(data.message);
                }

            })
            .catch(error => {
                console.error('Error:', error);
                alert('Une erreur est survenue.');
            });

        });

    });

});
</script>


{% endblock %}
